<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>ClusterStoreAndForward (matssocket 0.19.0-2022-11-11 API)</title>
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ClusterStoreAndForward (matssocket 0.19.0-2022-11-11 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":6,"i1":6,"i2":6,"i3":6,"i4":6,"i5":6,"i6":6,"i7":6,"i8":6,"i9":6,"i10":6,"i11":6,"i12":6,"i13":6,"i14":6,"i15":6,"i16":6,"i17":6,"i18":6,"i19":6,"i20":6,"i21":6,"i22":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../io/mats3/matssocket/AuthenticationPlugin.SessionAuthenticator.html" title="interface in io.mats3.matssocket"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.CurrentNode.html" title="interface in io.mats3.matssocket"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?io/mats3/matssocket/ClusterStoreAndForward.html" target="_top">Frames</a></li>
<li><a href="ClusterStoreAndForward.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">io.mats3.matssocket</div>
<h2 title="Interface ClusterStoreAndForward" class="title">Interface ClusterStoreAndForward</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../io/mats3/matssocket/impl/ClusterStoreAndForward_SQL.html" title="class in io.mats3.matssocket.impl">ClusterStoreAndForward_SQL</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">ClusterStoreAndForward</span></pre>
<div class="block">MatsSockets forwards requests from WebSocket-connected clients to a Mats Endpoint, and must get the reply back to the
 client. The WebSocket is "static" in that it is a fixed connection to one specific node (as long as the connection is
 up), which means that we need to get the message back to the same node that fired off the request. We could have used
 the same logic as with MatsFuturizer (i.e. the "last jump" uses a node-specific Topic), but that was deemed too
 feeble: We want reliable messaging all the way to the client. We want to be able to handle that the client looses the
 connection (e.g. sitting on a train which drives through a tunnel), and thus will reconnect. He might not come back
 to the same server as last time. We also want to be able to reboot any server (typically deploy of new code) at any
 time, but this obviously kills all WebSockets that are attached to it. To be able to ensure reliable messaging for
 MatsSockets, we need to employ a "store and forward" logic: When the reply comes in, which as with standard Mats
 logic can happen on any node in the cluster of nodes handling this Endpoint Stage, the reply message is temporarily
 stored in some reliable storage. We then look up which node that currently holds the MatsSession, and notify it about
 new messages for that session. This node gets the notice, finds the now local MatsSession, and forwards the message.
 Note that it is possible that the node getting the reply, and the node which holds the WebSocket/MatsSession, is the
 same node, in which case it eventually results in a local forward.
 <p/>
 Each node has his own instance of this class, connected to the same backing datastore.
 <p/>
 It is assumed that the consumption of messages for a session is done single threaded, on one node only. That is, only
 one thread on one node will actually <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getMessagesFromOutbox-java.lang.String-int-"><code>getMessagesFromOutbox(String, int)</code></a> get messages}, and, more
 importantly, <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesComplete-java.lang.String-java.util.Collection-"><code>register them as completed</code></a>. Wrt. multiple nodes,
 this argument still holds, since only one node can hold a MatsSocketSession - the one that has the actual WebSocket
 connection. I believe it is possible to construct a bad async situation here (connect to one node, authenticate, get
 SessionId, immediately disconnect and perform reconnect, and do this until the current <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html" title="interface in io.mats3.matssocket"><code>ClusterStoreAndForward</code></a>
 has the wrong idea of which node holds the Session) but this should at most result in the client screwing up for
 himself (not getting messages). A Session is not registered until the client has authenticated, so this will never
 lead to information leakage to other users. Such a situation will also resolve if the client again performs a
 non-malicious reconnect. It is the server that constructs and holds SessionIds: A client cannot itself force the
 server side to create a Session or SessionId - it can only reconnect to an existing SessionId that it was given
 earlier.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Interface and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.CurrentNode.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.CurrentNode</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></span></code>
<div class="block">If having problems accessing the underlying common data store.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.MessageIdAlreadyExistsException</a></span></code>
<div class="block">Thrown if the operation resulted in a Unique Constraint situation.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.RequestCorrelation.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.RequestCorrelation</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.SimpleCurrentNode.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.SimpleCurrentNode</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.SimpleRequestCorrelation.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.SimpleRequestCorrelation</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.SimpleStoredInMessage.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.SimpleStoredInMessage</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.SimpleStoredOutMessage.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.SimpleStoredOutMessage</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredInMessage.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.StoredInMessage</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static interface&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredOutMessage.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.StoredOutMessage</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.WrongUserException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.WrongUserException</a></span></code>
<div class="block">Thrown from <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#registerSessionAtThisNode-java.lang.String-java.lang.String-java.lang.String-java.lang.String-java.lang.String-java.lang.String-"><code>registerSessionAtThisNode(String, String, String, String, String, String)</code></a> if the userId does
 not match the original userId that created this session.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#boot--">boot</a></span>()</code>
<div class="block">Start the <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html" title="interface in io.mats3.matssocket"><code>ClusterStoreAndForward</code></a>, perform DB preparations and migrations.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#closeSession-java.lang.String-">closeSession</a></span>(java.lang.String&nbsp;matsSocketSessionId)</code>
<div class="block">Invoked when the client explicitly tells us that he closed this session, CLOSE_SESSION.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#deleteMessageIdsFromInbox-java.lang.String-java.util.Collection-">deleteMessageIdsFromInbox</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                         java.util.Collection&lt;java.lang.String&gt;&nbsp;clientMessageIds)</code>
<div class="block">Deletes the incoming message Ids, as we've established that the client will never try to send this particular
 message again.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#deregisterSessionFromThisNode-java.lang.String-java.lang.String-">deregisterSessionFromThisNode</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                             java.lang.String&nbsp;connectionId)</code>
<div class="block">Deregisters a Session home when a WebSocket is closed.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>java.util.Optional&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.RequestCorrelation.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.RequestCorrelation</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getAndDeleteRequestCorrelation-java.lang.String-java.lang.String-">getAndDeleteRequestCorrelation</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                              java.lang.String&nbsp;serverMessageId)</code>&nbsp;</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>java.util.Optional&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.CurrentNode.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.CurrentNode</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getCurrentRegisteredNodeForSession-java.lang.String-">getCurrentRegisteredNodeForSession</a></span>(java.lang.String&nbsp;matsSocketSessionId)</code>&nbsp;</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredInMessage.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.StoredInMessage</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getMessageFromInbox-java.lang.String-java.lang.String-">getMessageFromInbox</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                   java.lang.String&nbsp;clientMessageId)</code>&nbsp;</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>java.util.List&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredOutMessage.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.StoredOutMessage</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getMessagesFromOutbox-java.lang.String-int-">getMessagesFromOutbox</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                     int&nbsp;maxNumberOfMessages)</code>
<div class="block">Fetch a set of messages, up to 'maxNumberOfMessages' - but do not include messages that have been attempted
 delivered already (marked with <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesAttemptedDelivery-java.lang.String-java.util.Collection-"><code>outboxMessagesAttemptedDelivery(String, Collection)</code></a>).</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>java.util.List&lt;<a href="../../../io/mats3/matssocket/MatsSocketServer.MatsSocketSessionDto.html" title="class in io.mats3.matssocket">MatsSocketServer.MatsSocketSessionDto</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getSessions-boolean-java.lang.String-java.lang.String-java.lang.String-">getSessions</a></span>(boolean&nbsp;onlyActive,
           java.lang.String&nbsp;userId,
           java.lang.String&nbsp;appName,
           java.lang.String&nbsp;appVersionAtOrAbove)</code>
<div class="block">Direct implementation of <a href="../../../io/mats3/matssocket/MatsSocketServer.html#getMatsSocketSessions-boolean-java.lang.String-java.lang.String-java.lang.String-"><code>MatsSocketServer.getMatsSocketSessions(boolean, String, String, String)</code></a> - go
 read there for semantics.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getSessionsCount-boolean-java.lang.String-java.lang.String-java.lang.String-">getSessionsCount</a></span>(boolean&nbsp;onlyActive,
                java.lang.String&nbsp;userId,
                java.lang.String&nbsp;appName,
                java.lang.String&nbsp;appVersionAtOrAbove)</code>
<div class="block">Direct implementation of <a href="../../../io/mats3/matssocket/MatsSocketServer.html#getMatsSocketSessionsCount-boolean-java.lang.String-java.lang.String-java.lang.String-"><code>MatsSocketServer.getMatsSocketSessionsCount(boolean, String, String, String)</code></a> -
 go read there for semantics.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#isSessionExists-java.lang.String-">isSessionExists</a></span>(java.lang.String&nbsp;matsSocketSessionId)</code>&nbsp;</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#notifySessionLiveliness-java.util.Collection-">notifySessionLiveliness</a></span>(java.util.Collection&lt;java.lang.String&gt;&nbsp;matsSocketSessionIds)</code>
<div class="block">Shall be invoked on some kind of schedule (e.g.</div>
</td>
</tr>
<tr id="i12" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesAttemptedDelivery-java.lang.String-java.util.Collection-">outboxMessagesAttemptedDelivery</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                               java.util.Collection&lt;java.lang.String&gt;&nbsp;serverMessageIds)</code>
<div class="block">Marks the specified messages as attempted delivered and notches the <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredOutMessage.html#getDeliveryCount--"><code>ClusterStoreAndForward.StoredOutMessage.getDeliveryCount()</code></a>
 one up.</div>
</td>
</tr>
<tr id="i13" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesComplete-java.lang.String-java.util.Collection-">outboxMessagesComplete</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                      java.util.Collection&lt;java.lang.String&gt;&nbsp;serverMessageIds)</code>
<div class="block">States that the messages are delivered.</div>
</td>
</tr>
<tr id="i14" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesDeadLetterQueue-java.lang.String-java.util.Collection-">outboxMessagesDeadLetterQueue</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                             java.util.Collection&lt;java.lang.String&gt;&nbsp;serverMessageIds)</code>
<div class="block">States that the messages overran the accepted number of delivery attempts.</div>
</td>
</tr>
<tr id="i15" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesUnmarkAttemptedDelivery-java.lang.String-">outboxMessagesUnmarkAttemptedDelivery</a></span>(java.lang.String&nbsp;matsSocketSessionId)</code>
<div class="block">When this method is invoked, <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getMessagesFromOutbox-java.lang.String-int-"><code>getMessagesFromOutbox(String, int)</code></a> will again return messages that has
 previously been marked as attempted delivered with <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesAttemptedDelivery-java.lang.String-java.util.Collection-"><code>outboxMessagesAttemptedDelivery(String, Collection)</code></a>.</div>
</td>
</tr>
<tr id="i16" class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#registerSessionAtThisNode-java.lang.String-java.lang.String-java.lang.String-java.lang.String-java.lang.String-java.lang.String-">registerSessionAtThisNode</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                         java.lang.String&nbsp;userId,
                         java.lang.String&nbsp;connectionId,
                         java.lang.String&nbsp;clientLibAndVersions,
                         java.lang.String&nbsp;appName,
                         java.lang.String&nbsp;appVersion)</code>
<div class="block">Registers a Session home to this node - only one node can ever be home, so any old is deleted.</div>
</td>
</tr>
<tr id="i17" class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#scavengeSessionRemnants--">scavengeSessionRemnants</a></span>()</code>
<div class="block">Shall be invoked on some kind of schedule (e.g.</div>
</td>
</tr>
<tr id="i18" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#storeMessageIdInInbox-java.lang.String-java.lang.String-">storeMessageIdInInbox</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                     java.lang.String&nbsp;clientMessageId)</code>
<div class="block">Stores the incoming message Id, to avoid double delivery.</div>
</td>
</tr>
<tr id="i19" class="rowColor">
<td class="colFirst"><code>java.util.Optional&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.CurrentNode.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.CurrentNode</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#storeMessageInOutbox-java.lang.String-java.lang.String-java.lang.String-java.lang.String-io.mats3.matssocket.MatsSocketServer.MessageType-java.lang.Long-java.lang.String-java.lang.String-byte:A-">storeMessageInOutbox</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                    java.lang.String&nbsp;serverMessageId,
                    java.lang.String&nbsp;clientMessageId,
                    java.lang.String&nbsp;traceId,
                    <a href="../../../io/mats3/matssocket/MatsSocketServer.MessageType.html" title="enum in io.mats3.matssocket">MatsSocketServer.MessageType</a>&nbsp;type,
                    java.lang.Long&nbsp;requestTimestamp,
                    java.lang.String&nbsp;envelope,
                    java.lang.String&nbsp;messageJson,
                    byte[]&nbsp;messageBinary)</code>
<div class="block">Stores the message for the Session, returning the nodename for the node holding the session, if any.</div>
</td>
</tr>
<tr id="i20" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#storeRequestCorrelation-java.lang.String-java.lang.String-long-java.lang.String-java.lang.String-byte:A-">storeRequestCorrelation</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                       java.lang.String&nbsp;serverMessageId,
                       long&nbsp;requestTimestamp,
                       java.lang.String&nbsp;replyTerminatorId,
                       java.lang.String&nbsp;correlationString,
                       byte[]&nbsp;correlationBinary)</code>&nbsp;</td>
</tr>
<tr id="i21" class="rowColor">
<td class="colFirst"><code>java.util.Collection&lt;java.lang.String&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#timeoutSessions-long-">timeoutSessions</a></span>(long&nbsp;notLiveSinceTimestamp)</code>
<div class="block">Shall be invoked on some kind of schedule (e.g.</div>
</td>
</tr>
<tr id="i22" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#updateMessageInInbox-java.lang.String-java.lang.String-java.lang.String-byte:A-">updateMessageInInbox</a></span>(java.lang.String&nbsp;matsSocketSessionId,
                    java.lang.String&nbsp;clientMessageId,
                    java.lang.String&nbsp;messageJson,
                    byte[]&nbsp;messageBinary)</code>
<div class="block">Stores the resulting message (envelope and binary), so that if the incoming messages comes again (based on
 <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#storeMessageIdInInbox-java.lang.String-java.lang.String-"><code>storeMessageIdInInbox(String, String)</code></a> throwing <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket"><code>ClusterStoreAndForward.MessageIdAlreadyExistsException</code></a>), the result from
 the previous processing can be returned right away.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="boot--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>boot</h4>
<pre>void&nbsp;boot()</pre>
<div class="block">Start the <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html" title="interface in io.mats3.matssocket"><code>ClusterStoreAndForward</code></a>, perform DB preparations and migrations.</div>
</li>
</ul>
<a name="registerSessionAtThisNode-java.lang.String-java.lang.String-java.lang.String-java.lang.String-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerSessionAtThisNode</h4>
<pre>long&nbsp;registerSessionAtThisNode(java.lang.String&nbsp;matsSocketSessionId,
                               java.lang.String&nbsp;userId,
                               java.lang.String&nbsp;connectionId,
                               java.lang.String&nbsp;clientLibAndVersions,
                               java.lang.String&nbsp;appName,
                               java.lang.String&nbsp;appVersion)
                        throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.WrongUserException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.WrongUserException</a>,
                               <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Registers a Session home to this node - only one node can ever be home, so any old is deleted. When
 "re-registering" a session, it is asserted that the provided 'userId' is the same UserId as originally registered
 - a <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.WrongUserException.html" title="class in io.mats3.matssocket"><code>ClusterStoreAndForward.WrongUserException</code></a> is thrown if this does not match.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the SessionId for this connection.</dd>
<dd><code>userId</code> - the UserId, as provided by <a href="../../../io/mats3/matssocket/AuthenticationPlugin.html" title="interface in io.mats3.matssocket"><code>AuthenticationPlugin</code></a>, that own this MatsSocketSessionId</dd>
<dd><code>connectionId</code> - an id that is unique for this specific WebSocket Session (i.e. TCP Connection), so that if it closes,
            a new registration will not be deregistered by the old MatsSocketSession realizing that it is closed
            and then invoking <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#deregisterSessionFromThisNode-java.lang.String-java.lang.String-"><code>deregisterSessionFromThisNode(String, String)</code></a></dd>
<dd><code>clientLibAndVersions</code> - the Client Library and Versions + runtime information for the Client.</dd>
<dd><code>appName</code> - the AppName of the accessing Client app</dd>
<dd><code>appVersion</code> - the AppVersion of the accessing Client app</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the created timestamp - which is either "now" if this is the first register, or if it a "reconnect", when
         this MatsSocketSession was initially created</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.WrongUserException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.WrongUserException</a></code> - if the userId provided does not match the original userId that created the session.</dd>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code> - if problems with underlying data store.</dd>
</dl>
</li>
</ul>
<a name="getCurrentRegisteredNodeForSession-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCurrentRegisteredNodeForSession</h4>
<pre>java.util.Optional&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.CurrentNode.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.CurrentNode</a>&gt;&nbsp;getCurrentRegisteredNodeForSession(java.lang.String&nbsp;matsSocketSessionId)
                                                                                   throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the MatsSocketSessionId for which to find current session home.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the current node holding MatsSocket Session, or empty if none.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="isSessionExists-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isSessionExists</h4>
<pre>boolean&nbsp;isSessionExists(java.lang.String&nbsp;matsSocketSessionId)
                 throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the MatsSocketSessionId for which to check whether there is a session</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>whether a CSAF Session exists - NOTE: Not whether it is currently registered!</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="getSessions-boolean-java.lang.String-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSessions</h4>
<pre>java.util.List&lt;<a href="../../../io/mats3/matssocket/MatsSocketServer.MatsSocketSessionDto.html" title="class in io.mats3.matssocket">MatsSocketServer.MatsSocketSessionDto</a>&gt;&nbsp;getSessions(boolean&nbsp;onlyActive,
                                                                  java.lang.String&nbsp;userId,
                                                                  java.lang.String&nbsp;appName,
                                                                  java.lang.String&nbsp;appVersionAtOrAbove)
                                                           throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Direct implementation of <a href="../../../io/mats3/matssocket/MatsSocketServer.html#getMatsSocketSessions-boolean-java.lang.String-java.lang.String-java.lang.String-"><code>MatsSocketServer.getMatsSocketSessions(boolean, String, String, String)</code></a> - go
 read there for semantics.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the list of all MatsSocketSessions currently registered with this MatsSocketServer instance matching the
         constraints if set - as read from the <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html" title="interface in io.mats3.matssocket"><code>data store</code></a>.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="getSessionsCount-boolean-java.lang.String-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSessionsCount</h4>
<pre>int&nbsp;getSessionsCount(boolean&nbsp;onlyActive,
                     java.lang.String&nbsp;userId,
                     java.lang.String&nbsp;appName,
                     java.lang.String&nbsp;appVersionAtOrAbove)
              throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Direct implementation of <a href="../../../io/mats3/matssocket/MatsSocketServer.html#getMatsSocketSessionsCount-boolean-java.lang.String-java.lang.String-java.lang.String-"><code>MatsSocketServer.getMatsSocketSessionsCount(boolean, String, String, String)</code></a> -
 go read there for semantics.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the count of all MatsSocketSessions currently registered with this MatsSocketServer instance matching the
         constraints if set - as read from the <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html" title="interface in io.mats3.matssocket"><code>data store</code></a>.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="deregisterSessionFromThisNode-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deregisterSessionFromThisNode</h4>
<pre>void&nbsp;deregisterSessionFromThisNode(java.lang.String&nbsp;matsSocketSessionId,
                                   java.lang.String&nbsp;connectionId)
                            throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Deregisters a Session home when a WebSocket is closed. This node's nodename and this WebSocket Session's
 ConnectionId is taken into account, so that if it has changed async, it will not deregister a new session home
 (which can potentially be on the same node the 'connectionId' parameter).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the MatsSocketSessionId for which to deregister the specific WebSocket Session's ConnectionId.</dd>
<dd><code>connectionId</code> - an id that is unique for this specific WebSocket Session (i.e. TCP Connection), so that if it closes,
            a new registration will not be deregistered by the old MatsSocketSession realizing that it is closed
            and then invoking <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#deregisterSessionFromThisNode-java.lang.String-java.lang.String-"><code>deregisterSessionFromThisNode(String, String)</code></a></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="closeSession-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>closeSession</h4>
<pre>void&nbsp;closeSession(java.lang.String&nbsp;matsSocketSessionId)
           throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Invoked when the client explicitly tells us that he closed this session, CLOSE_SESSION. This deletes the session
 instance, and any messages in queue for it. No new incoming REPLYs, SENDs or RECEIVEs for this SessionId will be
 sent anywhere. (Notice that the implementation might still store any new outboxed messages, not checking that the
 session actually exists. But this SessionId will never be reused (exception without extreme "luck"), and the
 implementation will periodically purge such non-session-attached outbox messages).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the MatsSocketSessionId that should be closed.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="notifySessionLiveliness-java.util.Collection-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>notifySessionLiveliness</h4>
<pre>void&nbsp;notifySessionLiveliness(java.util.Collection&lt;java.lang.String&gt;&nbsp;matsSocketSessionIds)
                      throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Shall be invoked on some kind of schedule (e.g. every 1 minute) by every node to inform
 <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html" title="interface in io.mats3.matssocket"><code>ClusterStoreAndForward</code></a> about which Sessions are currently live on that node. Sessions that aren't live,
 will be scavenged after some time by invocation of <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#timeoutSessions-long-"><code>timeoutSessions(long)</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionIds</code> - which sessions are currently live on the invoking node.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="timeoutSessions-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>timeoutSessions</h4>
<pre>java.util.Collection&lt;java.lang.String&gt;&nbsp;timeoutSessions(long&nbsp;notLiveSinceTimestamp)
                                                throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Shall be invoked on some kind of schedule (e.g. every 10 minutes <i>on average</i>). Times out any session which
 have not been <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#notifySessionLiveliness-java.util.Collection-"><code>notified about liveliness</code></a> since the supplied timestamp
 (millis from epoch).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>notLiveSinceTimestamp</code> - decides which sessions are too old: Sessions which have not been
            <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#notifySessionLiveliness-java.util.Collection-"><code>notified about liveliness</code></a> since this timestamp will be
            deleted.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>which sessions was timed out.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="scavengeSessionRemnants--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>scavengeSessionRemnants</h4>
<pre>int&nbsp;scavengeSessionRemnants()
                     throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Shall be invoked on some kind of schedule (e.g. every hour <i>on average</i>). Scavenges all inboxes, outboxes
 and "request boxes" for any lingering data for closed and timed out sessions.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>how many items was scavenged, for logging. May return constant zero if not readily available.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="storeMessageIdInInbox-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>storeMessageIdInInbox</h4>
<pre>void&nbsp;storeMessageIdInInbox(java.lang.String&nbsp;matsSocketSessionId,
                           java.lang.String&nbsp;clientMessageId)
                    throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.MessageIdAlreadyExistsException</a>,
                           <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Stores the incoming message Id, to avoid double delivery. If the Client MessageId (cmid) already exists, a
 <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket"><code>ClusterStoreAndForward.MessageIdAlreadyExistsException</code></a> will be raised - this implies that a double delivery has occurred.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the MatsSocketSessionId for which to store the incoming message id.</dd>
<dd><code>clientMessageId</code> - the client's message Id for the incoming message.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.MessageIdAlreadyExistsException</a></code> - if the Client MessageId (cmid) already existed for this SessionId.</dd>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="updateMessageInInbox-java.lang.String-java.lang.String-java.lang.String-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateMessageInInbox</h4>
<pre>void&nbsp;updateMessageInInbox(java.lang.String&nbsp;matsSocketSessionId,
                          java.lang.String&nbsp;clientMessageId,
                          java.lang.String&nbsp;messageJson,
                          byte[]&nbsp;messageBinary)
                   throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Stores the resulting message (envelope and binary), so that if the incoming messages comes again (based on
 <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#storeMessageIdInInbox-java.lang.String-java.lang.String-"><code>storeMessageIdInInbox(String, String)</code></a> throwing <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket"><code>ClusterStoreAndForward.MessageIdAlreadyExistsException</code></a>), the result from
 the previous processing can be returned right away.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="getMessageFromInbox-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMessageFromInbox</h4>
<pre><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredInMessage.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.StoredInMessage</a>&nbsp;getMessageFromInbox(java.lang.String&nbsp;matsSocketSessionId,
                                                           java.lang.String&nbsp;clientMessageId)
                                                    throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="deleteMessageIdsFromInbox-java.lang.String-java.util.Collection-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deleteMessageIdsFromInbox</h4>
<pre>void&nbsp;deleteMessageIdsFromInbox(java.lang.String&nbsp;matsSocketSessionId,
                               java.util.Collection&lt;java.lang.String&gt;&nbsp;clientMessageIds)
                        throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Deletes the incoming message Ids, as we've established that the client will never try to send this particular
 message again.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the MatsSocketSessionId for which to delete the incoming message id.</dd>
<dd><code>clientMessageIds</code> - the client's message Ids for the incoming messages to delete.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="storeMessageInOutbox-java.lang.String-java.lang.String-java.lang.String-java.lang.String-io.mats3.matssocket.MatsSocketServer.MessageType-java.lang.Long-java.lang.String-java.lang.String-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>storeMessageInOutbox</h4>
<pre>java.util.Optional&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.CurrentNode.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.CurrentNode</a>&gt;&nbsp;storeMessageInOutbox(java.lang.String&nbsp;matsSocketSessionId,
                                                                            java.lang.String&nbsp;serverMessageId,
                                                                            java.lang.String&nbsp;clientMessageId,
                                                                            java.lang.String&nbsp;traceId,
                                                                            <a href="../../../io/mats3/matssocket/MatsSocketServer.MessageType.html" title="enum in io.mats3.matssocket">MatsSocketServer.MessageType</a>&nbsp;type,
                                                                            java.lang.Long&nbsp;requestTimestamp,
                                                                            java.lang.String&nbsp;envelope,
                                                                            java.lang.String&nbsp;messageJson,
                                                                            byte[]&nbsp;messageBinary)
                                                                     throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a>,
                                                                            <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.MessageIdAlreadyExistsException</a></pre>
<div class="block">Stores the message for the Session, returning the nodename for the node holding the session, if any. If the
 session is closed/timed out, the message won't be stored (i.e. dumped on the floor) and the return value is
 empty. The Server MessageId (smid) is set by the caller - and since this might have a collision, the method
 throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket"><code>ClusterStoreAndForward.MessageIdAlreadyExistsException</code></a> if unique constraint fails. In this case, a new Server MessageId
 should be picked and try again.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the matsSocketSessionId that the message is meant for.</dd>
<dd><code>serverMessageId</code> - unique id for outbox'ed message within the MatsSocketSessionId. Must be long enough that it is
            <b><i>extremely</i></b> unlikely that is collides with another message within the same
            MatsSocketSessionId - but do remember that there will at any one time be pretty few messages in the
            outbox for a given MatsSocketSession.</dd>
<dd><code>clientMessageId</code> - <b>For Client Replies to requests from Server-to-Client</b>, this is the Client's Message Id, which we
            need to send back with the Reply so that the Client can correlate the Request. (Nullable, since not
            all messages are replies).</dd>
<dd><code>traceId</code> - the server-side traceId for this message.</dd>
<dd><code>type</code> - the type of the outgoing message (RESOLVE, REJECT or PUB).</dd>
<dd><code>requestTimestamp</code> - <b>For Client Replies to requests from Server-to-Client</b>, this is the timestamp we received the
            Request.</dd>
<dd><code>envelope</code> - the JSON-serialized MatsSocket Envelope <b>without the 'msg' field set</b>.</dd>
<dd><code>messageJson</code> - the JSON-serialized message - the piece that sits in the 'msg' field of the Envelope. (Nullable)</dd>
<dd><code>messageBinary</code> - the binary part of an outgoing message. (Nullable)</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the current node holding MatsSocket Session, or empty if none.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.MessageIdAlreadyExistsException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.MessageIdAlreadyExistsException</a></code> - if the Server MessageId (smid) already existed for this SessionId.</dd>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="getMessagesFromOutbox-java.lang.String-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMessagesFromOutbox</h4>
<pre>java.util.List&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredOutMessage.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.StoredOutMessage</a>&gt;&nbsp;getMessagesFromOutbox(java.lang.String&nbsp;matsSocketSessionId,
                                                                              int&nbsp;maxNumberOfMessages)
                                                                       throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Fetch a set of messages, up to 'maxNumberOfMessages' - but do not include messages that have been attempted
 delivered already (marked with <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesAttemptedDelivery-java.lang.String-java.util.Collection-"><code>outboxMessagesAttemptedDelivery(String, Collection)</code></a>). If
 <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesUnmarkAttemptedDelivery-java.lang.String-"><code>outboxMessagesUnmarkAttemptedDelivery(String)</code></a> is invoked, that mark will be unset.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the matsSocketSessionId that the message is meant for.</dd>
<dd><code>maxNumberOfMessages</code> - the maximum number of messages to fetch.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a list of json encoded messages destined for the WebSocket.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="outboxMessagesAttemptedDelivery-java.lang.String-java.util.Collection-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>outboxMessagesAttemptedDelivery</h4>
<pre>void&nbsp;outboxMessagesAttemptedDelivery(java.lang.String&nbsp;matsSocketSessionId,
                                     java.util.Collection&lt;java.lang.String&gt;&nbsp;serverMessageIds)
                              throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">Marks the specified messages as attempted delivered and notches the <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredOutMessage.html#getDeliveryCount--"><code>ClusterStoreAndForward.StoredOutMessage.getDeliveryCount()</code></a>
 one up. If <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesUnmarkAttemptedDelivery-java.lang.String-"><code>outboxMessagesUnmarkAttemptedDelivery(String)</code></a> is invoked (typically on reconnect), the mark
 will be unset, but the delivery count will stay in place - this is to be able to abort delivery attempts if there
 is something wrong with the message.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the matsSocketSessionId that the serverMessageIds refers to.</dd>
<dd><code>serverMessageIds</code> - which messages failed delivery.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="outboxMessagesUnmarkAttemptedDelivery-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>outboxMessagesUnmarkAttemptedDelivery</h4>
<pre>void&nbsp;outboxMessagesUnmarkAttemptedDelivery(java.lang.String&nbsp;matsSocketSessionId)
                                    throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">When this method is invoked, <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#getMessagesFromOutbox-java.lang.String-int-"><code>getMessagesFromOutbox(String, int)</code></a> will again return messages that has
 previously been marked as attempted delivered with <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.html#outboxMessagesAttemptedDelivery-java.lang.String-java.util.Collection-"><code>outboxMessagesAttemptedDelivery(String, Collection)</code></a>.
 Notice that the <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredOutMessage.html#getDeliveryCount--"><code>ClusterStoreAndForward.StoredOutMessage.getDeliveryCount()</code></a> will not be reset, but the
 <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.StoredOutMessage.html#getAttemptTimestamp--"><code>ClusterStoreAndForward.StoredOutMessage.getAttemptTimestamp()</code></a> will now again return null.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the matsSocketSessionId whose messages now shall be attempted.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="outboxMessagesComplete-java.lang.String-java.util.Collection-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>outboxMessagesComplete</h4>
<pre>void&nbsp;outboxMessagesComplete(java.lang.String&nbsp;matsSocketSessionId,
                            java.util.Collection&lt;java.lang.String&gt;&nbsp;serverMessageIds)
                     throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">States that the messages are delivered. Will typically delete the message.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the matsSocketSessionId that the serverMessageIds refers to.</dd>
<dd><code>serverMessageIds</code> - which messages are complete.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="outboxMessagesDeadLetterQueue-java.lang.String-java.util.Collection-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>outboxMessagesDeadLetterQueue</h4>
<pre>void&nbsp;outboxMessagesDeadLetterQueue(java.lang.String&nbsp;matsSocketSessionId,
                                   java.util.Collection&lt;java.lang.String&gt;&nbsp;serverMessageIds)
                            throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<div class="block">States that the messages overran the accepted number of delivery attempts.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>matsSocketSessionId</code> - the matsSocketSessionId that the serverMessageIds refers to.</dd>
<dd><code>serverMessageIds</code> - which messages should be DLQed.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="storeRequestCorrelation-java.lang.String-java.lang.String-long-java.lang.String-java.lang.String-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>storeRequestCorrelation</h4>
<pre>void&nbsp;storeRequestCorrelation(java.lang.String&nbsp;matsSocketSessionId,
                             java.lang.String&nbsp;serverMessageId,
                             long&nbsp;requestTimestamp,
                             java.lang.String&nbsp;replyTerminatorId,
                             java.lang.String&nbsp;correlationString,
                             byte[]&nbsp;correlationBinary)
                      throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
<a name="getAndDeleteRequestCorrelation-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getAndDeleteRequestCorrelation</h4>
<pre>java.util.Optional&lt;<a href="../../../io/mats3/matssocket/ClusterStoreAndForward.RequestCorrelation.html" title="interface in io.mats3.matssocket">ClusterStoreAndForward.RequestCorrelation</a>&gt;&nbsp;getAndDeleteRequestCorrelation(java.lang.String&nbsp;matsSocketSessionId,
                                                                                             java.lang.String&nbsp;serverMessageId)
                                                                                      throws <a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.DataAccessException.html" title="class in io.mats3.matssocket">ClusterStoreAndForward.DataAccessException</a></code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../io/mats3/matssocket/AuthenticationPlugin.SessionAuthenticator.html" title="interface in io.mats3.matssocket"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../io/mats3/matssocket/ClusterStoreAndForward.CurrentNode.html" title="interface in io.mats3.matssocket"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?io/mats3/matssocket/ClusterStoreAndForward.html" target="_top">Frames</a></li>
<li><a href="ClusterStoreAndForward.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
